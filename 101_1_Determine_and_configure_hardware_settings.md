## 101.1 Определение и настройка аппаратной части

## Активация устройства

Если машина оснащена множеством устройств хранения данных, важно определить, какое из них имеет правильный загрузчик и должно быть первым в порядке загрузки устройств. Операционная система может не загрузиться, если неправильное устройство стоит первым в списке проверки загрузки BIOS.


## Проверка устройств в Linux

Когда часть оборудования не обнаруживается операционной системой, скорее всего, эта часть — или порт, к которому она подключена — неисправны. Когда часть оборудования обнаружена правильно, но все равно не работает должным образом, может быть проблема на стороне операционной системы. Поэтому одним из первых шагов при решении проблем, связанных с оборудованием, является проверка того, правильно ли операционная система обнаруживает устройство.

Существует два основных способа определения аппаратных ресурсов в системе Linux: использовать **команды** или **читать файлы** внутри специальных файловых систем.

_Команды для проверки:_

Вывод команд `lspci` и `lsusb` состоит из списка всех устройств PCI и USB. Однако устройство может быть еще не полностью работоспособным, поскольку для для корректоной работы нужен драйверю.

```
lspci - Показывает все устройства, подключенные в данный момент к шине PCI.
lspci -s 02:00.0 -v - Больше подробностей о конкретном устройстве.
```
```
lsusb - Выводит список устройств USB, подключенных в данный момент к машине.
lsusb -v -d 0bda:b85c - Больше подробностей о конкретном устройстве.
lsusb -t - С опцией -t команда отображает текущие сопоставления USB-устройств в виде иерархического дерева.
```

Возможно, не все устройства имеют соответствующие модули, связанные с ними. Связь с некоторыми устройствами может осуществляться приложением напрямую, без посредничества, предоставляемого модулем. Тем не менее, в выводе, предоставленном lsusb -t, есть важная информация. Когда существует соответствующий модуль, его имя появляется в конце строки для устройства, как в `Driver=btusb`. Класс устройства определяет общую категорию, например, Устройство интерфейса пользователя, Беспроводная связь, Специфический класс поставщика, Массовое хранилище и т. д. Чтобы проверить, какое устройство использует модуль btusb, представленный в предыдущем листинге, номера `Bus` и `Dev` должны быть указаны в опции -s команды lsusb:
```
lsusb -s 01:3
```

## Mодули (драйвера)

Для правильной работы некоторых модулей (драйверов) требуются другие модули, как в случае с модулями для аудиоустройств `snd_hda_intel`:
```
lsmod
lsmod | fgrep -i snd_hda_intel
```

Команда `modprobe` может использоваться как для загрузки, так и для выгрузки модулей ядра:
```
sudo modprobe -r snd-hda-intel
```

Используя имя модуля в качестве единственного аргумента, команда modinfo показывает описание, файл, автора, лицензию, идентификацию, зависимости и доступные параметры для данного модуля. Настраиваемые параметры для модуля можно сделать постоянными, включив их в файл /etc/modprobe.conf или в отдельные файлы с расширением .conf в каталоге /etc/modprobe.d/. Опция -p заставит команду modinfo отображать все доступные параметры и игнорировать остальную информацию:

```
sudo modinfo snd-hda-intel
```

Если модуль вызывает проблемы, можно использовать файл `/etc/modprobe.d/blacklist.conf` для блокировки загрузки модуля. Например, чтобы предотвратить автоматическую загрузку модуля nouveau, необходимо добавить строку `blacklist` nouveau в файл `/etc/modprobe.d/blacklist.conf`. Это действие требуется, когда установлен фирменный модуль nvidia, а модуль по умолчанию nouveau следует отложить.

Вы можете изменить файл `/etc/modprobe.d/blacklist.conf`, который уже существует в системе по умолчанию. Однако предпочтительным методом является создание отдельного файла конфигурации, `/etc/modprobe.d/<module_name>.conf`, который будет содержать настройки, специфичные только для данного модуля ядра.




## Информационные файлы и файлы устройств

Команды `lspci`, `lsusb` и `lsmod` действуют как интерфейсы для чтения информации об оборудовании, хранящейся в операционной системе. Этот тип информации хранится в специальных файлах в каталогах /proc и /sys. Эти каталоги являются точками монтирования файловых систем, которые находятся только в пространстве ОЗУ, используемом ядром для хранения конфигурации времени выполнения и информации о запущенных процессах. Такие файловые системы не предназначены для обычного хранения файлов, поэтому они называются псевдофайловыми системами и существуют только во время работы системы. 

### /proc
содержит файлы с информацией о запущенных процессах и аппаратных ресурсах. Некоторые важные файлы в `/proc` для проверки оборудования:

`/proc/cpuinfo`
содержит подробную информацию о ЦП, найденных операционной системой.

`/proc/interrupts`
список номеров прерываний на устройство ввода-вывода для каждого ЦП.

`/proc/ioports`
содержит список зарегистрированных в настоящее время используемых регионов портов ввода-вывода.

`/proc/dma`
выводит список зарегистрированных используемых каналов DMA (прямой доступ к памяти).


### /sys
хранение информации об устройстве и данных ядра, связанных с оборудованием


### /dev
каждый файл внутри /dev связан с системным устройством, в частности с устройствами хранения данных.


### udev
Съемные устройства обрабатываются подсистемой udev, которая создает соответствующие устройства в `/dev`. Ядро Linux захватывает событие обнаружения оборудования и передает его процессу udev, который затем идентифицирует устройство и динамически создает соответствующие файлы в `/dev`, используя предопределенные правила.

В текущих дистрибутивах Linux udev отвечает за идентификацию и настройку устройств, уже присутствующих во время включения машины (обнаружение холодного подключения, coldplug detection), и устройств, идентифицированных во время работы системы (обнаружение горячего подключения, hotplug detection). Udev использует SysFS, псевдофайловую систему для информации, связанной с оборудованием, смонтированную в /sys.

При обнаружении новых устройств `udev` ищет соответствующее правило в предопределенных правилах, хранящихся в каталоге `/etc/udev/rules.d/`. Наиболее важные правила предоставляются дистрибутивом, но для особых случаев могут быть добавлены новые.















=================================

16 команд для проверки аппаратной части компьютера в Linux

1. lscpu - Команда lscpu выдает информацию о процессоре и его составляющих. В ней нет каких-либо дополнительных параметров или функциональных возможностей.
2. lshw - список аппаратных устройств. Утилита общего назначения, которая сообщает подробную и краткую информацию о нескольких различных аппаратных устройствах, таких как процессор, память, диск, контроллеры usb, сетевые адаптеры и т.д. Команда lscpu извлекает информацию из различных файлов /proc.
3. hwinfo – информация об аппаратуре компьютера. Утилита hwinfo является еще одной универсальной утилитой зондирования аппаратуры, которая может сообщить подробную и краткую информацию о многих различных аппаратных компонентах, причем может сообщить больше, чем утилита lshw.
4. lspci – список устройств PCI. Команда lspci выдает список всех шин PCI, а также подробную информация об устройствах, которые к ним подключены. Под эту категорию подпадают следующие устройства — адаптер vga, графическая карта, сетевой адаптер, порты usb, контроллеры sata и т.д.
5. lsscsi — список устройств scsi. Выдается список устройств scsi/sata, например, жестких дисков и оптических приводов.
6. lsusb – подробный список шин и устройств usb. Эта команда показывает информацию о контроллерах usb и подробные сведения о подключенных к ним устройствах. По умолчанию выдается краткая информация. Для того, чтобы о каждом порте usb получить подробную информацию, используйте параметр "-v".
7. Inxi - является мега скриптом bash, состоящим из 10000 строк кода, с помощью которого из разных источников и команд системы будет получена подробная информация об аппаратном обеспечении и будет создан отчет в виде, позволяющим его читать пользователям, которые не являются техническими специалистами.
8. lsblk — список блочных устройств. Перечисляется информация о всех блочных устройствах, которыми являются разделы жестких дисков и других устройств хранения данных, например, оптических приводов и флэш-накопителей.
9. df – дисковое пространство файловых систем. Отчеты о различных разделах, об их точках монтирования и о том, сколько в каждом разделе есть свободного места.
10. Pydf – команда df, написанная на языке Python. Улучшенный вариант команды df , написанной на языке python, который выдает информацию в цвете, что выглядит лучше, чем информация, выдаваемая командой df
11. fdisk - Fdisk является утилитой, предназначенной для изменения разделов жестких дисков, и ей также можно пользоваться для получения информации о списке имеющихся разделов.
12. mount - Команда mount используется для монтирования/демонтирования, а также для просмотра смонтированных файловых систем.
13. free – проверка оперативной памяти. С помощью команды free проверьте объем используемой, свободной и общий объема оперативной памяти, имеющейся в системе.
14. dmidecode - Команда dmidecode отличается от всех других команд. Она извлекает информацию об оборудовании, читая для этого данные из структур данных SMBOIS (которые также называются таблицами DMI).
15. Файлы /proc - Во многих виртуальных файлах каталога /proc содержится информация об аппаратном обеспечении и о конфигурациях. Ниже приведены некоторые из них.
16. hdparm - Команда hdparm получает информацию об устройствах sata, например, жестких дисков.
