## Determine and configure hardware settings

### <a name='toc'>Содержание</a>

1. [BIOS или UEFI](#1)
2. [The Bootloader (Загрузчик)](#2)
3. [System Initialization (Инициализация системы)](#3)
4. [Initialization Inspection (Инициализация Инспекции)](#4)
5. [Storage Devices (Устройства хранения данных)](#5)
6. [Guided Exercises (Упражнения с инструкциями)](#6)
7. [Summary (Резюме)](#7)

### Введение

Чтобы управлять машиной, основной компонент операционной системы — ядро ​​— должен быть загружен программой, называемой загрузчиком, которая сама загружается предустановленной прошивкой, такой как BIOS или UEFI. Загрузчик можно настроить для передачи параметров ядру, например, какой раздел содержит корневую файловую систему или в каком режиме должна выполняться операционная система. После загрузки ядро ​​продолжает процесс загрузки, идентифицируя и настраивая оборудование. Наконец, ядро ​​вызывает утилиту, отвечающую за запуск и управление службами системы.

> В некоторых дистрибутивах Linux для выполнения команд в этом уроке могут потребоваться права root.

### [[⬆]](#toc) <a name='1'>BIOS или UEFI</a>

Процедуры, выполняемые машинами x86 для запуска загрузчика, различаются в зависимости от того, используют ли они BIOS или UEFI. BIOS, сокращение от Basic Input/Output System, представляет собой программу, хранящуюся в энергонезависимой микросхеме памяти, подключенной к материнской плате, которая выполняется каждый раз при включении компьютера. Этот тип программы называется встроенным ПО, и ее место хранения отделено от других устройств хранения, которые могут быть в системе. BIOS предполагает, что первые 440 байтов в первом устройстве хранения — в соответствии с порядком, определенным в утилите конфигурации BIOS — являются первым этапом загрузчика (также называемым bootstrap). Первые 512 байтов устройства хранения называются MBR (Master Boot Record) устройств хранения, использующих стандартную схему разделов DOS, и, в дополнение к первому этапу загрузчика, содержат таблицу разделов. Если MBR не содержит правильных данных, система не сможет загрузиться, если не будет использован альтернативный метод.

В целом, предварительные этапы загрузки системы, оснащенной BIOS, следующие:

1. Процесс POST (самотестирование при включении питания) выполняется для выявления простых аппаратных сбоев сразу после включения машины.
2. BIOS активирует основные компоненты для загрузки системы, такие как видеовыход, клавиатура и носители информации.
3. BIOS загружает первый этап загрузчика из MBR (первые 440 байт первого устройства, как определено в утилите конфигурации BIOS).
4. Первый этап загрузчика вызывает второй этап загрузчика, отвечающий за представление параметров загрузки и загрузку ядра.

UEFI, сокращение от Unified Extensible Firmware Interface, отличается от BIOS в некоторых ключевых моментах. Как и BIOS, UEFI также является прошивкой, но она может идентифицировать разделы и считывать множество файловых систем, обнаруженных в них. UEFI не полагается на MBR, принимая во внимание только настройки, хранящиеся в его энергонезависимой памяти (NVRAM), подключенной к материнской плате. Эти определения указывают местоположение совместимых с UEFI программ, называемых приложениями EFI, которые будут выполняться автоматически или вызываться из меню загрузки. Приложения EFI могут быть загрузчиками, селекторами операционных систем, инструментами для диагностики и ремонта системы и т. д. Они должны находиться в обычном разделе устройства хранения данных и в совместимой файловой системе. Стандартными совместимыми файловыми системами являются FAT12, FAT16 и FAT32 для блочных устройств и ISO-9660 для оптических носителей. Такой подход позволяет реализовать гораздо более сложные инструменты, чем те, которые возможны с BIOS.

Раздел, содержащий приложения EFI, называется системным разделом EFI или просто ESP. Этот раздел не должен использоваться совместно с другими системными файловыми системами, такими как корневая файловая система или файловые системы пользовательских данных. Каталог EFI в разделе ESP содержит приложения, на которые указывают записи, сохраненные в NVRAM.

В общем, шаги по загрузке операционной системы в системе с UEFI следующие:

1. Процесс POST (самотестирование при включении питания) выполняется для выявления простых аппаратных сбоев сразу после включения машины.
2. UEFI активирует основные компоненты для загрузки системы, такие как видеовыход, клавиатура и носители информации.
3. Прошивка UEFI считывает определения, хранящиеся в NVRAM, для выполнения предопределенного приложения EFI, хранящегося в файловой системе раздела ESP. Обычно предопределенное приложение EFI является загрузчиком.
4. Если предопределенное приложение EFI является загрузчиком, оно загрузит ядро ​​для запуска операционной системы.

Стандарт UEFI также поддерживает функцию, называемую _Secure Boot_, которая позволяет выполнять только подписанные приложения EFI, то есть приложения EFI, авторизованные производителем оборудования. Эта функция повышает защиту от вредоносного ПО, но может затруднить установку операционных систем, не покрываемых гарантией производителя.


### [[⬆]](#toc) <a name='2'>The Bootloader (Загрузчик)</a>

Самый популярный загрузчик для Linux в архитектуре x86 — GRUB (Grand Unified Bootloader). Как только он вызывается BIOS или UEFI, GRUB отображает список операционных систем, доступных для загрузки. Иногда список не появляется автоматически, но его можно вызвать, нажав Shift во время вызова GRUB BIOS. В системах UEFI вместо этого следует использовать клавишу Esc.

В меню GRUB можно выбрать, какое из установленных ядер следует загрузить, и передать ему новые параметры. Большинство параметров ядра следуют шаблону option=value. Вот некоторые из наиболее полезных параметров ядра:

`acpi`
Включает/отключает поддержку ACPI. `acpi=off` отключит поддержку ACPI.

`init`
Устанавливает альтернативный системный инициатор. Например, init=/bin/bash установит оболочку Bash в качестве инициатора. Это означает, что сеанс оболочки начнется сразу после процесса загрузки ядра.

`systemd.unit`
Устанавливает активируемую цель systemd. Например, systemd.unit=graphical.target. Systemd также принимает числовые уровни выполнения, определенные для SysV. Например, чтобы активировать уровень выполнения 1, необходимо включить только число 1 или букву S (сокращение от «single») в качестве параметра ядра.

`mem`
Устанавливает объем доступной оперативной памяти для системы. Этот параметр полезен для виртуальных машин, чтобы ограничить объем оперативной памяти, доступный каждому гостю. Использование mem=512M ограничит объем доступной оперативной памяти для конкретной гостевой системы до 512 мегабайт.

`maxcpus`
Ограничивает количество процессоров (или ядер процессора), видимых системе в симметричных многопроцессорных машинах. Он также полезен для виртуальных машин. Значение 0 отключает поддержку многопроцессорных машин и имеет тот же эффект, что и параметр ядра nosmp. Параметр maxcpus=2 ограничит количество процессоров, доступных операционной системе, двумя.

`quiet`
Скрывает большинство сообщений загрузки.

`vga`
Выбирает видеорежим. Параметр vga=ask покажет список доступных режимов для выбора.

`root`
Устанавливает корневой раздел, отличный от предварительно настроенного в загрузчике. Например, root=/dev/sda3.

`rootflags`
Параметры монтирования для корневой файловой системы.

`ro`
Делает начальное монтирование корневой файловой системы доступным только для чтения.

`rw`
Разрешает запись в корневую файловую систему во время начального монтирования.

Изменение параметров ядра обычно не требуется, но может быть полезно для обнаружения и решения проблем, связанных с операционной системой. Параметры ядра должны быть добавлены в файл /etc/default/grub в строке GRUB_CMDLINE_LINUX, чтобы сделать их постоянными при перезагрузках. Новый файл конфигурации для загрузчика должен быть сгенерирован каждый раз при изменении /etc/default/grub, что выполняется командой grub-mkconfig -o /boot/grub/grub.cfg. После запуска операционной системы параметры ядра, используемые для загрузки текущего сеанса, доступны для чтения в файле /proc/cmdline.

> Configuring GRUB will be discussed further in a later lesson.



### [[⬆]](#toc) <a name='3'>System Initialization (Инициализация системы)</a>

Помимо ядра, операционная система зависит от других компонентов, которые обеспечивают ожидаемые функции. Многие из этих компонентов загружаются во время процесса инициализации системы, варьируясь от простых сценариев оболочки до более сложных служебных программ. Скрипты часто используются для выполнения краткосрочных задач, которые будут запускаться и завершаться во время процесса инициализации системы. Службы, также известные как демоны, могут быть активны все время, поскольку они могут отвечать за внутренние аспекты операционной системы.

Разнообразие способов, которыми сценарии запуска и демоны с самыми разными характеристиками могут быть встроены в дистрибутив Linux, огромно, что исторически препятствовало разработке единого решения, которое отвечало бы ожиданиям сопровождающих и пользователей всех дистрибутивов Linux. Однако любой инструмент, который сопровождающие дистрибутива выбрали для выполнения этой функции, по крайней мере сможет запускать, останавливать и перезапускать системные службы. Эти действия часто выполняются самой системой после обновления программного обеспечения, например, но системному администратору почти всегда нужно будет вручную перезапускать службу после внесения изменений в ее файл конфигурации.

Также системному администратору удобно иметь возможность активировать определенный набор демонов в зависимости от обстоятельств. Например, должна быть возможность запускать только минимальный набор служб для выполнения задач по обслуживанию системы.

> Строго говоря, операционная система — это просто ядро ​​и его компоненты, которые контролируют оборудование и управляют всеми процессами. Однако термин «операционная система» принято использовать более свободно, обозначая целую группу отдельных программ, составляющих программную среду, в которой пользователь может выполнять основные вычислительные задачи.

Инициализация операционной системы начинается, когда загрузчик загружает ядро ​​в ОЗУ. Затем ядро ​​берет на себя управление ЦП и начинает обнаруживать и настраивать основные аспекты операционной системы, такие как базовая конфигурация оборудования и адресация памяти.

Затем ядро ​​открывает initramfs (_начальную файловую систему ОЗУ_). Initramfs — это архив, содержащий файловую систему, используемую как временная корневая файловая система во время процесса загрузки. Основное назначение файла `initramfs` — предоставить необходимые модули, чтобы ядро ​​могло получить доступ к «реальной» корневой файловой системе операционной системы.

Как только корневая файловая система станет доступна, ядро ​​смонтирует все файловые системы, настроенные в `/etc/fstab`, а затем выполнит первую программу — утилиту с именем `init`. Программа `init` отвечает за запуск всех скриптов инициализации и системных демонов. Существуют различные реализации таких системных инициаторов, помимо традиционного `init`, такие как `systemd` и `Upstart`. После загрузки программы `init initramfs` удаляется из оперативной памяти.

`Стандарт SysV`
Менеджер служб, основанный на стандарте SysVinit, контролирует, какие демоны и ресурсы будут доступны, используя концепцию уровней выполнения. Уровни выполнения пронумерованы от 0 до 6 и разработаны разработчиками дистрибутивов для выполнения определенных целей. Единственными определениями уровней выполнения, общими для всех дистрибутивов, являются уровни выполнения 0, 1 и 6.

`systemd`
systemd — это современный менеджер систем и служб с уровнем совместимости для команд и уровней выполнения SysV. systemd имеет параллельную структуру, использует сокеты и D-Bus для активации служб, выполнения демонов по требованию, мониторинга процессов с помощью cgroups, поддержки снимков, восстановления системных сеансов, управления точками монтирования и управления службами на основе зависимостей. В последние годы большинство основных дистрибутивов Linux постепенно приняли systemd в качестве своего системного менеджера по умолчанию.

`Upstart`
Как и systemd, Upstart является заменой init. Цель Upstart — ускорить процесс загрузки путем распараллеливания процесса загрузки системных служб. Upstart использовался в дистрибутивах на базе Ubuntu в прошлых выпусках, но сегодня уступил место systemd.



### [[⬆]](#toc) <a name='4'>Initialization Inspection (Инициализация Инспекции)</a>















